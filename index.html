<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Наследство Теней: Детективная История</title>
    <style>
        /* Базовые стили для игры */
        body {
            font-family: 'Georgia', serif; /* Более "детективный" шрифт */
            background-color: #e0e0e0; /* Светло-серый фон */
            color: #333;
            margin: 0;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            line-height: 1.6;
            box-sizing: border-box;
        }
        #game-container {
            background-color: #fff;
            border: 2px solid #555; /* Темнее рамка */
            border-radius: 10px;
            padding: 20px;
            max-width: 95%;
            width: 100%;
            box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.3); /* Более выраженная тень */
            box-sizing: border-box;
        }
        h1 {
            color: #4a004a; /* Глубокий фиолетовый/бордовый */
            text-align: center;
            margin-bottom: 20px;
            font-size: 2em;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        h2 {
            color: #666;
            border-bottom: 1px solid #ccc;
            padding-bottom: 5px;
            margin-top: 20px;
            margin-bottom: 10px;
        }
        #story-text {
            min-height: 150px;
            margin-bottom: 20px;
            background-color: #f8f8f8;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 5px;
            white-space: pre-wrap;
            font-size: 1.1em;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.05);
        }
        #actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }
        .action-button {
            background-color: #5d3f6a; /* Темно-фиолетовый */
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.1em;
            transition: background-color 0.3s ease, transform 0.1s ease;
            flex-grow: 1;
            min-width: 130px;
            max-width: 48%;
            box-sizing: border-box;
        }
        /* Стиль для кнопок исследования */
        .examine-button {
            background-color: #8bb14c; /* Зеленый для исследования */
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.95em;
            transition: background-color 0.3s ease;
            margin-top: 5px;
            display: block; /* Каждая кнопка на новой строке */
            width: 100%;
            box-sizing: border-box;
        }
        .examine-button:hover {
            background-color: #6a8c3d;
        }

        @media (max-width: 480px) {
            .action-button {
                max-width: 100%;
            }
        }
        .action-button:hover {
            background-color: #4a004a;
            transform: translateY(-2px);
        }
        .action-button:active {
            transform: translateY(0);
        }
        #game-info {
            display: flex;
            flex-direction: column;
            width: 100%;
            margin-top: 20px;
            border-top: 1px solid #ddd;
            padding-top: 15px;
        }
        #inventory, #attention-info, #journal-section {
            background-color: #f0f0f0; /* Светлее для инфо-блоков */
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 5px;
            width: 100%;
            margin-bottom: 15px;
            box-sizing: border-box;
        }
        #attention-bar {
            width: 100%;
            background-color: #ddd;
            border-radius: 5px;
            height: 20px;
            margin-top: 5px;
            overflow: hidden;
        }
        #attention-fill {
            height: 100%;
            background-color: #8bb14c; /* Зеленый для внимательности */
            width: 0%;
            transition: width 0.5s ease-out;
        }
        #inventory-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        #inventory-list li {
            padding: 5px 0;
            border-bottom: 1px dotted #bbb;
            font-size: 0.95em;
        }
        #inventory-list li:last-child {
            border-bottom: none;
        }
        .game-over-message {
            color: #d32f2f; /* Красный для сообщения о конце игры */
            font-size: 1.2em;
            font-weight: bold;
            text-align: center;
            margin-top: 20px;
        }
        #journal-content {
            width: 100%;
            min-height: 100px;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            font-family: 'Georgia', serif;
            font-size: 0.95em;
            background-color: #fff;
            box-sizing: border-box;
            resize: vertical; /* Разрешить изменение размера по вертикали */
        }
    </style>
</head>
<body>
    <div id="game-container">
        <h1>Наследство Теней</h1>
        <div id="story-text"></div>
        <div id="actions">
            <!-- Кнопки действий будут здесь -->
        </div>
        <div id="game-info">
            <div id="inventory">
                <h2>Инвентарь:</h2>
                <ul id="inventory-list">
                    <li>(пусто)</li>
                </ul>
            </div>
            <div id="attention-info">
                <h2>Внимательность:</h2>
                <div id="attention-bar">
                    <div id="attention-fill"></div>
                </div>
                <p id="attention-text">50/100</p>
            </div>
        </div>
        <div id="journal-section">
            <h2>Журнал Детектива</h2>
            <textarea id="journal-content" placeholder="Здесь вы можете записывать свои заметки и улики..."></textarea>
        </div>
    </div>

    <script>
        // --- Данные Игры ---
        const ITEMS = {
            "письмо_юриста": { name: "Письмо от Юриста", description: "Официальное письмо о наследстве, от юридической фирмы 'Гримшоу и Партнеры'." },
            "старый_ключ": { name: "Старый ключ", description: "Массивный, потемневший ключ с необычной гравировкой. Возможно, от особняка." },
            "странная_записка": { name: "Странная Записка", description: "Пожелтевшая бумага с неразборчивым почерком и странными символами. Похоже на шифр.", type: "puzzle" },
            "лупа": { name: "Лупа", description: "Старая, но качественная лупа. Поможет рассмотреть мелкие детали.", effect: "increase_attention" }
        };

        const LOCATIONS = {
            "юридическая_контора": {
                name: "Юридическая Контора 'Гримшоу и Партнеры'",
                description: "Вы сидите в душном кабинете, пропахшем старой бумагой и надеждами. Пожилой юрист, мистер Гримшоу, медленно проталкивает по столу пожелтевший конверт. 'Это касается вашего дальнего родственника...', - начинает он.",
                exits: { "Открыть конверт": "получение_наследства" },
                items: [],
                examineActions: {
                    "Осмотреть кабинет": {
                        description: "Кабинет выглядит обычным, но на полке вы замечаете старую, пыльную лупу.",
                        effect: () => {
                            if (!inventory.includes("лупа")) {
                                storyTextElement.innerText += "\n\nВы нашли старую лупу!";
                                takeItem("лупа", LOCATIONS["юридическая_контора"]); // Добавляем лупу в инвентарь
                            } else {
                                storyTextElement.innerText += "\n\nВы уже осмотрели кабинет и взяли лупу.";
                            }
                            attentionLevel += 5; // Немного увеличиваем внимательность за наблюдение
                            updateAttention();
                        }
                    }
                },
                attentionImpact: 0,
                visited: false
            },
            "получение_наследства": {
                name: "Получение Наследства",
                description: "Внутри конверта вы находите официальные бумаги о вашем прадеде, о котором вы едва слышали, свидетельство о смерти и... старый, необычно массивный ключ. К нему прикреплена пожелтевшая записка с символами. 'Всё это ваше, мистер/мисс...', - говорит юрист, - 'включая особняк на окраине города. Хотя... я бы не спешил туда ехать.'",
                exits: { "Спросить об особняке": "разговор_юрист_особняк", "Взять ключ и записку": "покинуть_контору" },
                items: ["старый_ключ", "странная_записка"],
                examineActions: {
                    "Внимательно изучить письмо": {
                        description: "Помимо официальных формулировок, вы замечаете на полях письма еле заметную водяную метку в виде переплетенных инициалов 'Э.Т.'.",
                        effect: () => {
                            storyTextElement.innerText += "\n\nВы нашли еле заметную водяную метку 'Э.Т.' на письме. Это может быть важно!";
                            // Можно добавить эту информацию в журнал автоматически
                            journalContentElement.value += "\n- На письме обнаружена водяная метка: Э.Т.";
                            attentionLevel += 5;
                            updateAttention();
                        }
                    }
                },
                attentionImpact: 10,
                visited: false
            },
            "разговор_юрист_особняк": {
                name: "Беседа с Юристом об Особняке",
                description: "Мистер Гримшоу поправляет очки. 'Особняк... он давно пустует. Ходят слухи. Странные вещи происходили. Никто не хочет покупать. Ваш прадед был... эксцентричным человеком. Некоторые считают, что он что-то скрывал.' Юрист смотрит на вас с беспокойством.",
                exits: { "Покинуть контору": "покинуть_контору" },
                items: [],
                examineActions: {
                    "Попытаться выведать больше": {
                        description: "Юрист нервно потирает руки. 'Я не могу разглашать детали. Просто будьте осторожны. Ваш прадед... он был одержим тайнами.'",
                        effect: () => {
                            storyTextElement.innerText += "\n\nЮрист явно что-то недоговаривает, но больше информации из него не вытянуть.";
                            attentionLevel -= 5; // Немного теряем внимательность, если не удалось ничего узнать
                            updateAttention();
                        }
                    }
                },
                attentionImpact: 5,
                visited: false
            },
            "покинуть_контору": {
                name: "Возвращение Домой",
                description: "Вы покидаете душную контору. На улице яркий свет дня кажется неестественным после мрачной атмосферы. В руках у вас ключ и странная записка. Мысли о заброшенном особняке и словах юриста не дают покоя. Кажется, ваша обычная жизнь только что закончилась.",
                exits: { "Отправиться в особняк": "особняк_снаружи", "Изучить записку дома": "изучение_записки" },
                items: [],
                examineActions: {
                    "Подумать о прадеде": {
                        description: "Вы пытаетесь вспомнить хоть что-то о своем прадеде, но в памяти лишь смутные, обрывочные сведения о его затворническом образе жизни.",
                        effect: () => {
                            storyTextElement.innerText += "\n\nПока ничего конкретного о прадеде вспомнить не удается. Нужно больше информации.";
                            attentionLevel += 2; // Небольшое увеличение внимательности за размышления
                            updateAttention();
                        }
                    }
                },
                attentionImpact: 0,
                visited: false
            },
            "особняк_снаружи": {
                name: "Заброшенный Особняк: Снаружи",
                description: "Вы стоите перед массивными чугунными воротами. За ними — заросший сад и сам особняк, темный и молчаливый. Окна кажутся пустыми глазницами, смотрящими на вас. Воздух вокруг кажется плотным, а тишина — неестественной. Где-то вдалеке слышится карканье ворона.",
                exits: { "Попытаться открыть ворота": "ворота_особняка", "Осмотреть окрестности": "осмотр_особняка_снаружи" },
                items: [],
                examineActions: {
                    "Осмотреть ворота": {
                        description: "Ворота массивные, покрыты ржавчиной. Замок выглядит старым, но прочным. Кажется, ключ должен подойти.",
                        effect: () => {
                            storyTextElement.innerText += "\n\nВорота выглядят так, будто их давно не открывали. Ваш ключ может быть полезен.";
                            attentionLevel += 5;
                            updateAttention();
                        }
                    },
                    "Посмотреть на окна особняка": {
                        description: "Окна грязные, некоторые разбиты. За одним из них, на втором этаже, вам кажется, мелькнула тень...",
                        effect: () => {
                            storyTextElement.innerText += "\n\nВам показалось, или за окном что-то движется? Это тревожит.";
                            // Здесь можно добавить эффект страха, если бы он был
                            attentionLevel += 3;
                            updateAttention();
                        }
                    }
                },
                attentionImpact: 15,
                visited: false
            },
            "ворота_особняка": {
                name: "Ворота Особняка",
                description: "Вы подошли к воротам. Замок выглядит старым и заржавевшим. Ваш ключ должен подойти.",
                exits: {}, // Динамически добавляются
                items: [],
                examineActions: {
                    "Использовать ключ": {
                        description: "Вы вставляете ключ в замок. Со скрипом и скрежетом, замок поддается. Ворота медленно отворяются, открывая путь в заросший сад.",
                        effect: () => {
                            if (inventory.includes("старый_ключ")) {
                                storyTextElement.innerText += "\n\nКлюч подошел! Ворота отворились. Теперь можно войти в сад.";
                                LOCATIONS["ворота_особняка"].exits["Войти в сад"] = "сад_особняка"; // Добавляем новый выход
                                displayLocation("ворота_особняка"); // Обновляем кнопки
                                attentionLevel += 10;
                                updateAttention();
                            } else {
                                storyTextElement.innerText += "\n\nУ вас нет подходящего ключа. Ворота наглухо заперты.";
                            }
                        }
                    }
                },
                attentionImpact: 0,
                visited: false
            },
            "сад_особняка": {
                name: "Заросший Сад",
                description: "Вы входите в сад. Когда-то здесь, вероятно, были прекрасные клумбы, но теперь это дикие заросли. Высокие сорняки, колючие кусты и искривленные деревья создают лабиринт. В воздухе витает запах сырости и чего-то еще... чего-то старого и забытого.",
                exits: { "Идти к дому": "вход_в_особняк", "Осмотреть сад": "осмотр_сада" },
                items: [],
                examineActions: {
                    "Прислушаться к звукам": {
                        description: "Вы слышите легкий шелест в кустах, но это, скорее всего, ветер. Или нет?",
                        effect: () => {
                            storyTextElement.innerText += "\n\nКажется, ничего необычного. Или это просто нервы?";
                            attentionLevel += 2;
                            updateAttention();
                        }
                    }
                },
                attentionImpact: 10,
                visited: false
            },
            "осмотр_особняка_снаружи": {
                name: "Осмотр Окрестностей Особняка",
                description: "Вы обходите особняк по периметру, стараясь найти другой вход или что-то необычное. Стены покрыты плющом, некоторые окна заколочены. Сзади дома вы видите старый сарай, полуразрушенный.",
                exits: { "Вернуться к воротам": "особняк_снаружи", "Осмотреть сарай": "старый_сарай" },
                items: [],
                examineActions: {
                    "Изучить стены особняка": {
                        description: "На одной из стен, скрытой плющом, вы замечаете выцарапанные символы, похожие на те, что на записке. Они едва различимы.",
                        effect: () => {
                            storyTextElement.innerText += "\n\nНа стене особняка найдены символы, похожие на те, что на записке! Это подтверждает, что записка связана с этим местом.";
                            journalContentElement.value += "\n- Символы на стене особняка совпадают с символами на записке.";
                            attentionLevel += 15;
                            updateAttention();
                        }
                    }
                },
                attentionImpact: 10,
                visited: false
            },
            "старый_сарай": {
                name: "Старый Сарай",
                description: "Деревянный сарай почти развалился. Дверь висит на одной петле, внутри темно и пахнет плесенью и чем-то металлическим. Кажется, здесь давно никто не был.",
                exits: { "Вернуться к особняку": "осмотр_особняка_снаружи", "Войти в сарай": "внутри_сарая" },
                items: [],
                examineActions: {
                    "Осмотреть замок": {
                        description: "Замок на двери сарая сломан, его легко открыть.",
                        effect: () => {
                            storyTextElement.innerText += "\n\nЗамок сломан, можно войти.";
                        }
                    }
                },
                attentionImpact: 5,
                visited: false
            },
            "внутри_сарая": {
                name: "Внутри Сарая",
                description: "Внутри сарая беспорядок: старые инструменты, ящики, покрытые паутиной. В углу вы замечаете что-то блестящее под грудой тряпок.",
                exits: { "Выйти из сарая": "старый_сарай" },
                items: ["старая_лопата"], // Пример предмета
                examineActions: {
                    "Осмотреть блестящий предмет": {
                        description: "Под тряпками лежит старая, но крепкая лопата.",
                        effect: () => {
                            if (!inventory.includes("старая_лопата")) {
                                storyTextElement.innerText += "\n\nВы нашли старую лопату. Возможно, пригодится в саду.";
                                takeItem("старая_лопата", LOCATIONS["внутри_сарая"]);
                            } else {
                                storyTextElement.innerText += "\n\nВы уже взяли лопату.";
                            }
                            attentionLevel += 5;
                            updateAttention();
                        }
                    }
                },
                attentionImpact: 10,
                visited: false
            },
            "изучение_записки": {
                name: "Изучение Странной Записки",
                description: "Дома, в спокойной обстановке, вы раскладываете пожелтевшую записку. Символы на ней кажутся бессмысленными, но в них чувствуется какая-то логика. Это явно шифр. Ваша внимательность поможет вам.",
                exits: { "Отправиться в особняк": "особняк_снаружи" },
                items: [],
                examineActions: {
                    "Попытаться расшифровать": {
                        description: "Вы сосредоточенно изучаете записку. Некоторые символы кажутся повторяющимися, другие напоминают обрывки слов. Это сложно, но вы чувствуете, что разгадка близка. (Требуется определенный уровень внимательности)",
                        effect: () => {
                            if (attentionLevel >= 60) { // Требуется 60 внимательности для успешной расшифровки
                                storyTextElement.innerText += "\n\nВнезапно символы складываются в слова! Это карта... и инструкции. Вы расшифровали ее! На карте указано место в саду особняка, отмеченное как 'Старый Колодец'.";
                                journalContentElement.value += "\n- Записка расшифрована! Указано место: Старый Колодец в саду.";
                                // Добавляем новый выход или предмет после успешной расшифровки
                                LOCATIONS["изучение_записки"].exits["Вернуться в особняк с новой информацией"] = "сад_особняка";
                                LOCATIONS["сад_особняка"].exits["Найти Старый Колодец"] = "старый_колодец"; // Добавляем новый путь в саду
                                attentionLevel += 20; // Значительное увеличение внимательности за успешную расшифровку
                                updateAttention();
                                displayLocation(currentLocation); // Обновляем кнопки
                            } else {
                                storyTextElement.innerText += "\n\nВы пытаетесь, но символы слишком запутаны. Вам не хватает внимательности, чтобы понять их. Возможно, нужно найти что-то, что поможет вам сосредоточиться или увеличит вашу внимательность.";
                                attentionLevel = Math.max(0, attentionLevel - 10); // Уменьшаем внимательность при неудаче
                                updateAttention();
                            }
                        }
                    }
                },
                attentionImpact: 5,
                visited: false
            },
            "старый_колодец": {
                name: "Старый Колодец",
                description: "В заросшей части сада вы находите старый, полуразрушенный колодец. Его края покрыты мхом, а внутри царит непроглядная тьма. От него веет холодом и чем-то... очень старым.",
                exits: { "Вернуться в сад": "сад_особняка" },
                items: [],
                examineActions: {
                    "Заглянуть в колодец": {
                        description: "Вы заглядываете в колодец. Там очень темно. Вы слышите слабый плеск воды и... что-то еще, похожее на шепот.",
                        effect: () => {
                            storyTextElement.innerText += "\n\nКолодец кажется очень глубоким и таинственным. Что-то там есть...";
                            attentionLevel += 5;
                            updateAttention();
                        }
                    }
                },
                attentionImpact: 15,
                visited: false
            }
            // Добавьте больше локаций по мере развития сюжета
        };

        // --- Переменные Состояния Игры ---
        let currentLocation = "юридическая_контора";
        let inventory = [];
        let attentionLevel = 50; // Начальный уровень внимательности
        const MAX_ATTENTION = 100;

        // --- Элементы DOM ---
        const storyTextElement = document.getElementById('story-text');
        const actionsElement = document.getElementById('actions');
        const inventoryListElement = document.getElementById('inventory-list');
        const attentionFillElement = document.getElementById('attention-fill');
        const attentionTextElement = document.getElementById('attention-text');
        const journalContentElement = document.getElementById('journal-content'); // Элемент для журнала

        // --- Функции Игровой Логики ---

        function displayLocation(locationId) {
            const location = LOCATIONS[locationId];
            if (!location) {
                storyTextElement.innerText = "Ошибка: Локация не найдена. Попробуйте перезагрузить игру.";
                actionsElement.innerHTML = "";
                return;
            }

            storyTextElement.innerText = location.description;

            // Обновляем внимательность при первом посещении
            if (!location.visited) {
                attentionLevel += location.attentionImpact;
                location.visited = true;
            }
            updateAttention();

            actionsElement.innerHTML = ""; // Очищаем предыдущие действия

            // Добавляем кнопки переходов (выходов)
            for (const exitText in location.exits) {
                const button = document.createElement('button');
                button.classList.add('action-button');
                button.innerText = exitText;
                button.onclick = () => {
                    currentLocation = location.exits[exitText];
                    displayLocation(currentLocation);
                };
                actionsElement.appendChild(button);
            }

            // Добавляем кнопки для подбора предметов
            if (location.items && location.items.length > 0) {
                let itemsAvailableInLocation = location.items.filter(itemId => !inventory.includes(itemId));

                if (itemsAvailableInLocation.length > 0) {
                    itemsAvailableInLocation.forEach(itemId => {
                        const item = ITEMS[itemId];
                        if (item) {
                            const button = document.createElement('button');
                            button.classList.add('action-button');
                            button.innerText = `Взять: ${item.name}`;
                            button.onclick = (event) => {
                                event.stopPropagation(); // Предотвращаем срабатывание других кликов
                                takeItem(itemId, location);
                            };
                            actionsElement.appendChild(button);
                        }
                    });
                }
            }

            // Добавляем кнопки для использования предметов из инвентаря
            if (inventory.length > 0) {
                inventory.forEach(itemId => {
                    const item = ITEMS[itemId];
                    if (item && item.effect) {
                        const button = document.createElement('button');
                        button.classList.add('action-button');
                        button.innerText = `Использовать: ${item.name}`;
                        button.onclick = (event) => {
                            event.stopPropagation();
                            useItem(itemId);
                        };
                        actionsElement.appendChild(button);
                    }
                });
            }

            // Добавляем кнопки для исследования (Examine Actions)
            if (location.examineActions) {
                for (const actionText in location.examineActions) {
                    const button = document.createElement('button');
                    button.classList.add('examine-button'); // Новый класс для стилизации
                    button.innerText = `Исследовать: ${actionText}`;
                    button.onclick = (event) => {
                        event.stopPropagation();
                        location.examineActions[actionText].effect();
                        displayLocation(currentLocation); // Обновляем кнопки после исследования
                    };
                    actionsElement.appendChild(button);
                }
            }
        }

        function updateInventory() {
            inventoryListElement.innerHTML = "";
            if (inventory.length === 0) {
                inventoryListElement.innerHTML = "<li>(пусто)</li>";
            } else {
                inventory.forEach(itemId => {
                    const item = ITEMS[itemId];
                    if (item) {
                        const listItem = document.createElement('li');
                        listItem.innerText = `${item.name}: ${item.description}`;
                        inventoryListElement.appendChild(listItem);
                    }
                });
            }
        }

        function updateAttention() {
            attentionLevel = Math.max(0, Math.min(attentionLevel, MAX_ATTENTION));
            const percentage = (attentionLevel / MAX_ATTENTION) * 100;
            attentionFillElement.style.width = `${percentage}%`;
            attentionTextElement.innerText = `${attentionLevel}/${MAX_ATTENTION}`;

            if (attentionLevel === 0) {
                endGame("недостаточно_внимательности");
            }
        }

        function takeItem(itemId, location) {
            if (!inventory.includes(itemId)) {
                inventory.push(itemId);
                // Удаляем предмет из локации, чтобы его нельзя было взять снова
                if (location && location.items) { // Проверяем, что location и items существуют
                    location.items = location.items.filter(item => item !== itemId);
                }
                updateInventory();
                displayLocation(currentLocation); // Обновляем кнопки действий
            }
        }

        function useItem(itemId) {
            const item = ITEMS[itemId];
            if (item && item.effect) {
                switch (item.effect) {
                    case "increase_attention":
                        attentionLevel += 20;
                        storyTextElement.innerText += "\n\nВы используете лупу. Мир вокруг становится четче, детали бросаются в глаза. Ваша внимательность улучшилась!";
                        // Лупа не удаляется, так как она может быть многоразовой
                        break;
                    default:
                        storyTextElement.innerText += `\n\nВы пытаетесь использовать ${item.name}, но сейчас это не дает никакого видимого эффекта.`;
                        break;
                }
                // Если предмет одноразовый, удалите его из инвентаря
                // inventory = inventory.filter(id => id !== itemId);
                updateInventory();
                updateAttention();
                displayLocation(currentLocation); // Обновляем кнопки действий
            } else {
                storyTextElement.innerText += `\n\nВы не можете использовать ${item.name} таким образом.`;
            }
        }


        function endGame(reason) {
            actionsElement.innerHTML = "";
            const gameOverMessage = document.createElement('p');
            gameOverMessage.classList.add('game-over-message');

            if (reason === "недостаточно_внимательности") {
                gameOverMessage.innerText = "Вы потеряли нить расследования, слишком много деталей ускользнуло от вашего внимания. Тайна остается неразгаданной...";
            } else {
                gameOverMessage.innerText = "Игра окончена. " + reason;
            }
            storyTextElement.appendChild(gameOverMessage);

            const restartButton = document.createElement('button');
            restartButton.classList.add('action-button');
            restartButton.innerText = "Начать заново";
            restartButton.onclick = () => location.reload();
            actionsElement.appendChild(restartButton);
        }

        // --- Запуск Игры ---
        window.onload = () => {
            displayLocation(currentLocation);
            updateInventory();
            updateAttention(); // Обновляем индикатор внимательности при старте
        };
    </script>
</body>
</html>
